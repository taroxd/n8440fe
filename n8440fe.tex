% !TeX program = LuaLaTeX
% !TeX encoding = UTF-8

\documentclass{article}

\usepackage{luatexja}
\usepackage{luatexja-ruby}
\usepackage[no-math]{luatexja-fontspec}
% \usepackage[ZhongYi]{luatexja-zhfonts}
\usepackage[a5paper]{geometry}
\usepackage{float}
\usepackage{titlesec}
\usepackage{setspace}
% \usepackage{newunicodechar}
\usepackage[yyyymmdd]{datetime}
\usepackage{indentfirst}
% \usepackage{tipa}  % for \textsubdot
\usepackage[perpage]{footmisc}
\usepackage[unicode,hidelinks]{hyperref}
\usepackage[numbered]{bookmark}
\usepackage{luacode}

% 思源黑体
\newjfontfamily{\jpfont}[
  BoldFont=SourceHanSansJP-Bold,
  YokoFeatures={JFM=prop}
]{SourceHanSansJP-Normal}
% 方正兰亭黑系列
\setmainjfont[
  BoldFont=FZLTZHK--GBK1-0,
  YokoFeatures={JFM=prop}
]{FZLTXIHK--GBK1-0}
\renewcommand{\familydefault}{\sfdefault}

\ltjsetparameter{prebreakpenalty={`—, 10000}}

\onehalfspacing
\titlespacing*{\subsection}{0pt}{8.9ex}{3.4ex}

\def\two@digits#1{\ifnum#1<10 0\fi\number#1}
\renewcommand{\thesubsection}{\two@digits{\value{subsection}}}
\renewcommand{\contentsname}{目录}
\renewcommand{\abstractname}{简介}
\renewcommand{\dateseparator}{.}

\counterwithout{subsection}{section}
\newcommand*\sectotoc[1]{
  \section*{#1}
  \addcontentsline{toc}{section}{#1}
}

\title{关于邻家的天使大人不知不觉把我惯成了废人这档子事}
\author{
    \begin{tabular}{rl}
        作者 & {\jpfont 佐伯さん} \tabularnewline
        翻译 & taroxd, tongyuantongyu, 浪人,  \tabularnewline
             & kae, 冰川镜华, 纱优纱优 \tabularnewline
        校对 & taroxd \tabularnewline
        制作 & 大括号不换行汉化组
    \end{tabular}
}

\begin{document}

\maketitle

\begin{abstract}
藤宫\ruby{周}{\jpfont あまね}住的公寓邻家住着一位学校人气第一的可爱天使。

拥有被唤作天使的美貌，优秀少女——椎名真昼。周是并无特别出彩之处的普通学生，他曾经以为，尽管她是邻居，自己在过去和未来都不会和她扯上关系。

直到他遇见雨中湿透的天使。

「人情我会还的。说起来，房间最好整理一下。简直看不下去」

「要你多管」

天使大人说话有些严格，两人的关系从把伞硬塞给她之后开始。

周感冒时前来照料，指责周不爱护身体而来帮忙做饭，两人进行共同作业（打扫房间），一起出门……

最初冷淡而后逐渐变得开始撒娇的真昼，和一开始是怕麻烦的消极主义却不知何时敞开了心扉的周——

这是不坦率的两人逐渐走近的故事。
\end{abstract}

\tableofcontents
\newpage

\sectotoc{第一章}

\luaexec{
  for i=1,63,1 do
    tex.sprint(string.format("\\setcounter{subsection}{\%d}", i-1))
    tex.sprint(string.format("\\input{\%04d}", i))
  end
}

\end{document}
